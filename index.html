<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Weekly Meal Plan</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1 class="site-title">WeeklyMeal</h1>
            <nav>
                <ul class="nav-menu">
                    <li><a class="nav-link" href="home.php"><span>üè†</span> Home</a></li>
                    <li><a class="nav-link" href="plan.php"><span>üìã</span> Plan</a></li>
                    <li><a class="nav-link" href="meal_plan.php"><span>üçΩÔ∏è</span> Meals</a></li>
                    <li><a class="nav-link" href="consumption.php"><span>üìä</span> Stats</a></li>
                    <li><a class="nav-link" href="contact.php"><span>üìû</span> Contact</a></li>
                    <li><a class="nav-link" href="about.php"><span>‚ÑπÔ∏è</span> About</a></li>
                    <li><a class="nav-link" href="logout.php"><span>üö™</span> Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h2 class="section-title">Your Weekly Meal Plan</h2>
        <div id="meal-plan" class="loading">
            <div class="loading-spinner"></div>
            <p>Crafting your personalized meal plan...</p>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const apiKey = "f99adf078c7b4a23a510ef22b8f1e7e8";
            const demoUrl = `https://api.spoonacular.com/mealplanner/generate?timeFrame=week&apiKey=${apiKey}`;

            async function fetchMealPlan() {
                try {
                    const response = await fetch(demoUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log("API Response:", data); // For debugging
                    if (data.week) {
                        displayMealPlan(data.week);
                    } else {
                        throw new Error("Invalid response format");
                    }
                } catch (error) {
                    console.error("Error fetching meal plan:", error);
                    document.getElementById("meal-plan").innerHTML = `
                        <div class="alert alert-danger" role="alert">
                            Error loading meal plan: ${error.message}
                        </div>`;
                }
            }

            function displayMealPlan(weekData) {
                const container = document.getElementById("meal-plan");
                container.innerHTML = "";
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                
                const mealGrid = document.createElement("div");
                mealGrid.className = "meal-grid";
                
                days.forEach(day => {
                    const dayMeals = weekData[day];
                    if (dayMeals && dayMeals.meals) {
                        const dayCard = document.createElement("div");
                        dayCard.className = "day-card";
                        dayCard.innerHTML = `
                            <div class="day-header">
                                ${day.charAt(0).toUpperCase() + day.slice(1)}
                            </div>
                            <div class="day-content">
                                ${dayMeals.meals.map(meal => `
                                    <div class="meal-item">
                                        <img src="https://spoonacular.com/recipeImages/${meal.id}-636x393.jpg" 
                                             class="meal-image" alt="${meal.title}">
                                        <div class="meal-info">
                                            <h3 class="meal-title">${meal.title}</h3>
                                            <div class="meal-meta">
                                                <span>üïí ${meal.readyInMinutes}min</span>
                                                <span>üë• ${meal.servings} servings</span>
                                            </div>
                                            <a href="${meal.sourceUrl}" class="view-recipe" target="_blank">View Recipe</a>
                                        </div>
                                    </div>
                                `).join('')}
                                ${dayMeals.nutrients ? `
                                    <div class="nutrition-box">
                                        <h4 class="nutrition-title">Daily Nutrition</h4>
                                        <ul class="nutrition-list">
                                            <li class="nutrition-item">
                                                <strong>${Math.round(dayMeals.nutrients.calories)}</strong>
                                                <div>calories</div>
                                            </li>
                                            <li class="nutrition-item">
                                                <strong>${Math.round(dayMeals.nutrients.protein)}g</strong>
                                                <div>protein</div>
                                            </li>
                                            <li class="nutrition-item">
                                                <strong>${Math.round(dayMeals.nutrients.fat)}g</strong>
                                                <div>fat</div>
                                            </li>
                                            <li class="nutrition-item">
                                                <strong>${Math.round(dayMeals.nutrients.carbohydrates)}g</strong>
                                                <div>carbs</div>
                                            </li>
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                        mealGrid.appendChild(dayCard);
                    }
                });
                
                container.appendChild(mealGrid);
            }

            fetchMealPlan();
        });
    </script>
</body>
</html>